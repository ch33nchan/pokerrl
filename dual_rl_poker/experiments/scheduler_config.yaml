# Scheduler Experiment Configuration
# This configuration tests the new ARMAC scheduler components

experiment:
  name: "scheduler_validation"
  description: "Comprehensive testing of ARMAC scheduler with per-instance lambda adaptation"
  seed: 42
  total_iterations: 500
  eval_every: 25

# Game configuration
game:
  name: "kuhn_poker"
  num_players: 2

# ARMAC algorithm configuration
algorithm:
  type: "armac"

  # Enable scheduler components
  use_scheduler: true

  # Network architecture
  hidden_dims: [128, 64]
  network:
    hidden_dims: [128, 64]
    dropout: 0.1

  # Training parameters
  training:
    batch_size: 64
    buffer_size: 10000
    gamma: 0.99
    tau: 0.005
    gradient_clip: 5.0

  # Learning rates
  actor_lr: 1e-4
  critic_lr: 1e-3
  regret_lr: 1e-3
  scheduler_lr: 1e-4

  # Legacy lambda settings (fallback if scheduler disabled)
  mixture_weight: 0.1
  lambda_mode: "adaptive"
  lambda_alpha: 2.0

  # Update frequencies
  policy_update_frequency: 1
  value_update_frequency: 1
  regret_update_frequency: 1

  # Scheduler configuration
  scheduler:
    # Scheduler network architecture
    hidden: [64, 32]

    # Mode: "continuous" or "discrete"
    # discrete: selects from K bins, meta-regret tracking
    # continuous: outputs lambda in [0,1] directly
    k_bins: [0.0, 0.25, 0.5, 0.75, 1.0]  # Comment out for continuous mode

    # Discrete mode settings
    temperature: 1.0
    use_gumbel: true

    # Continuous mode settings (if k_bins not specified)
    # temperature: not used
    # use_gumbel: not used

  # Policy mixer configuration
  policy_mixer:
    discrete: true  # Should match scheduler mode
    lambda_bins: [0.0, 0.25, 0.5, 0.75, 1.0]  # Should match scheduler k_bins
    temperature_decay: 0.99
    min_temperature: 0.1

  # Meta-regret configuration (only used for discrete mode)
  meta_regret:
    K: 5  # Number of discrete choices
    decay: 0.99  # EMA decay for utility averaging
    initial_regret: 0.0
    regret_min: 0.0
    smoothing_factor: 1e-6

  # Component ablations
  disable_regret: false
  disable_critic: false
  disable_actor: false

# Evaluation configuration
evaluation:
  num_episodes: 100
  nashconv_computation: true
  exploitability_computation: true
  baseline_comparison: true

# Logging configuration
logging:
  log_level: "INFO"
  log_interval: 10
  save_checkpoints: true
  checkpoint_interval: 100
  tensorboard: true

# Results configuration
results:
  output_dir: "results/scheduler_experiments"
  save_trajectories: true
  save_models: true
  plot_scheduler_stats: true
  plot_lambda_evolution: true
  plot_mixing_dynamics: true

# Multiple experiment configurations for comparison
experiments:
  # Baseline: Fixed lambda
  baseline_fixed:
    algorithm:
      use_scheduler: false
      mixture_weight: 0.1
      lambda_mode: "fixed"
    name_suffix: "fixed_lambda"

  # Baseline: Adaptive lambda (legacy)
  baseline_adaptive:
    algorithm:
      use_scheduler: false
      mixture_weight: 0.1
      lambda_mode: "adaptive"
      lambda_alpha: 2.0
    name_suffix: "adaptive_lambda"

  # Continuous scheduler
  continuous_scheduler:
    algorithm:
      use_scheduler: true
      scheduler:
        # k_bins not specified -> continuous mode
        hidden: [64, 32]
      policy_mixer:
        discrete: false
    name_suffix: "continuous_scheduler"

  # Discrete scheduler with meta-regret
  discrete_scheduler:
    algorithm:
      use_scheduler: true
      scheduler:
        k_bins: [0.0, 0.2, 0.4, 0.6, 0.8, 1.0]
        temperature: 1.0
        use_gumbel: true
      policy_mixer:
        discrete: true
        lambda_bins: [0.0, 0.2, 0.4, 0.6, 0.8, 1.0]
      meta_regret:
        K: 6
        decay: 0.99
    name_suffix: "discrete_scheduler"

  # Discrete scheduler with more bins
  discrete_fine:
    algorithm:
      use_scheduler: true
      scheduler:
        k_bins: [0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
        temperature: 0.8
        use_gumbel: true
      policy_mixer:
        discrete: true
        lambda_bins: [0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
      meta_regret:
        K: 11
        decay: 0.98
    name_suffix: "discrete_fine"
